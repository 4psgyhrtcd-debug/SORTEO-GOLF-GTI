<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>SORTEO GOLF GTI 2025</title>
  <style>
    :root{
      --accent:#ef1b1b;
      --bg:#0f1720;
      --card:#0b1220;
      --muted:#97a0ad;
      --ok:#0bcd55;
      --sold:#ad1a2c;
      --reserved:#f59e0b;
    }
    *{box-sizing:border-box}
    body{
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      margin:0;
      background:linear-gradient(180deg,#07111a 0%, #071021 60%);
      color:#eef2f7
    }
    .container{max-width:1100px;margin:28px auto;padding:20px}

    /* HEADER CENTRADO */
    header{
      display:flex;
      flex-direction:column;
      gap:16px;
      align-items:center;
      text-align:center;
    }

    /* T√çTULO SUPER LLAMATIVO ROJO‚ÄìDORADO‚ÄìVERDE */
    .title-main{
      margin:0;
      font-size:clamp(40px, 7vw, 66px);
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:0.20em;
      background:linear-gradient(
        90deg,
        #ef4444,   /* rojo */
        #facc15,   /* dorado */
        #22c55e    /* verde */
      );
      background-size:250% auto;
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      text-shadow:
        0 0 14px rgba(239,68,68,0.7),
        0 0 26px rgba(250,204,21,0.8),
        0 0 36px rgba(34,197,94,0.8);
      animation:titleGlow 3.5s ease-in-out infinite alternate;
    }

    @keyframes titleGlow{
      0%{
        background-position:0% 50%;
        text-shadow:
          0 0 10px rgba(239,68,68,0.8),
          0 0 22px rgba(250,204,21,0.8),
          0 0 32px rgba(34,197,94,0.8);
      }
      100%{
        background-position:100% 50%;
        text-shadow:
          0 0 18px rgba(239,68,68,1),
          0 0 32px rgba(250,204,21,1),
          0 0 45px rgba(34,197,94,1);
      }
    }

    .subtitle{
      color:var(--muted);
      margin-top:6px;
      font-size:14px;
    }

    /* BOT√ìN WHATSAPP PRINCIPAL */
    .whatsapp-main{
      margin-top:14px;
      display:flex;
      justify-content:center;
    }
    .whatsapp-big{
      display:inline-flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:2px;
      padding:12px 26px;
      border-radius:999px;
      background:linear-gradient(90deg,#22c55e,#16a34a);
      color:#ecfdf5;
      text-decoration:none;
      font-weight:600;
      font-size:17px;
      box-shadow:0 10px 28px rgba(22,163,74,0.55);
      animation:pulse 1.7s infinite;
      transform:translateY(0);
      transition:transform 0.15s ease, box-shadow 0.15s ease;
    }
    .whatsapp-big span.icon-row{
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .whatsapp-big span.small-text{
      font-size:12px;
      opacity:0.9;
    }
    .whatsapp-big:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 32px rgba(22,163,74,0.7);
    }
    @keyframes pulse{
      0%{box-shadow:0 0 0 0 rgba(34,197,94,0.9);}
      70%{box-shadow:0 0 0 18px rgba(34,197,94,0);}
      100%{box-shadow:0 0 0 0 rgba(34,197,94,0);}
    }

    .hero{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:18px}
    .card{
      background:rgba(255,255,255,0.03);
      padding:18px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(2,6,23,0.6)
    }
    .price-tag{
      background:rgba(255,255,255,0.04);
      padding:8px 12px;
      border-radius:999px;
      display:inline-block
    }
    .specs li{margin:6px 0}
    .grid{
      display:grid;
      grid-template-columns:repeat(10,1fr);
      gap:8px;
      margin-top:12px
    }

    /* ESTADOS DE LOS N√öMEROS */
    .num{
      padding:8px 6px;
      border-radius:8px;
      text-align:center;
      font-weight:600;
      cursor:pointer;
      border:1px solid rgba(255,255,255,0.09);
      font-size:13px;
      transition:
        background 0.18s ease,
        transform 0.18s ease,
        box-shadow 0.18s ease,
        border-color 0.18s ease;
    }
    .num.available{
      background:linear-gradient(180deg,rgba(15,118,110,0.22),rgba(6,78,59,0.35));
      color:#dff6e8;
    }
    .num.available.selected{
      background:linear-gradient(180deg,#22c55e,#15803d);
      border-color:#bbf7d0;
      box-shadow:0 0 0 1px rgba(190,242,100,0.9),0 10px 28px rgba(34,197,94,0.55);
      transform:translateY(-1px) scale(1.03);
    }
    .num.sold{
      background:linear-gradient(180deg,rgba(155,17,30,0.18),rgba(155,17,30,0.04));
      color:#ffd6d6;
      opacity:0.9;
      cursor:default
    }
    .num.reserved{
      background:linear-gradient(180deg,rgba(245,158,11,0.22),rgba(245,158,11,0.06));
      color:#fff7e6;
      cursor:default;
    }

    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:12px}
    .btn{
      background:var(--accent);
      border:none;
      color:#fff;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-size:14px;
    }
    .btn.ghost{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06)
    }
    .summary{
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .search{
      padding:8px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:inherit
    }
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:20px;color:var(--muted);font-size:13px}

    @media(max-width:900px){
      .hero{grid-template-columns:1fr}
      .grid{grid-template-columns:repeat(5,1fr)}
    }
    .legend{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
    }
    .legend span{
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .legend-dot{
      width:12px;
      height:12px;
      border-radius:4px;
      display:inline-block;
    }

    /* SLIDESHOW SIMPLE (sin carrusel) */
    .slideshow{
      position:relative;
      max-width:1000px;
      margin:24px auto 10px;
      overflow:hidden;
      border-radius:18px;
      box-shadow:0 12px 32px rgba(0,0,0,0.65);
      cursor:pointer;
    }
    .slideshow img{
      width:100%;
      display:block;
      transition:opacity 0.6s ease;
      opacity:1;
    }

    /* LIGHTBOX PARA ZOOM */
    #lightbox{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.85);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:70;
      cursor:zoom-out;
    }
    #lightbox img{
      max-width:90vw;
      max-height:90vh;
      border-radius:16px;
      box-shadow:0 20px 60px rgba(0,0,0,0.9);
    }

    /* BLOQUE DATOS BANCARIOS DESTACADO */
    .bank{
      font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background:linear-gradient(135deg,rgba(15,23,42,0.95),rgba(30,64,175,0.95));
      padding:14px 16px;
      border-radius:10px;
      border:1px solid rgba(129,140,248,0.7);
      box-shadow:0 10px 26px rgba(15,23,42,0.8);
      margin-top:4px;
    }
    .bank-label{
      font-size:11px;
      letter-spacing:0.16em;
      text-transform:uppercase;
      color:#a5b4fc;
      margin-bottom:6px;
    }
    .bank-name{
      font-weight:600;
      font-size:14px;
      color:#e5e7eb;
    }
    .bank-bank{
      font-size:13px;
      color:#c7d2fe;
    }
    .bank-account{
      margin-top:6px;
      font-size:18px;
      font-weight:700;
      letter-spacing:0.22em;
      color:#facc15;
    }
    .bank-note{
      margin-top:8px;
      font-size:11px;
      color:#e5e7eb;
    }

    /* BARRA FLOTANTE DE PAGO R√ÅPIDO */
    .quick-pay{
      position:fixed;
      bottom:12px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(15,23,42,0.96);
      border-radius:999px;
      padding:8px 16px;
      display:none;
      align-items:center;
      gap:12px;
      box-shadow:0 12px 30px rgba(0,0,0,0.75);
      border:1px solid rgba(248,250,252,0.12);
      z-index:60;
      max-width:95%;
    }
    .quick-pay-info{
      font-size:13px;
      color:#e5e7eb;
      white-space:nowrap;
    }
    .quick-pay-btn{
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
      background:linear-gradient(90deg,#22c55e,#16a34a);
      color:#ecfdf5;
      white-space:nowrap;
    }
    @media(max-width:600px){
      .quick-pay{
        border-radius:12px;
        flex-direction:column;
        align-items:stretch;
      }
      .quick-pay-info{
        text-align:center;
        white-space:normal;
      }
      .quick-pay-btn{
        width:100%;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <!-- SOLO UN T√çTULO, SIN SORTEO PREMIUM -->
      <div>
        <h1 class="title-main">SORTEO GOLF GTI 2025</h1>
        <div class="subtitle">
          üèéÔ∏è Totalmente nuevo ¬∑ Potencia, tecnolog√≠a y exclusividad
        </div>

        <!-- BOT√ìN WHATSAPP GRANDE Y DIN√ÅMICO -->
        <div class="whatsapp-main">
          <a class="whatsapp-big" href="https://wa.me/527711271531" target="_blank">
            <span class="icon-row">
              <span>üì≤</span>
              <span>¬°Quiero mi n√∫mero del GTI!</span>
            </span>
            <span class="small-text">WhatsApp directo: 771 127 1531</span>
          </a>
        </div>
      </div>
    </header>

    <!-- SLIDESHOW (cambio aleatorio) -->
    <div class="slideshow">
      <img id="slideshow-img" src="COCHERA .jpeg" alt="Golf GTI 2025">
    </div>

    <!-- LIGHTBOX -->
    <div id="lightbox">
      <img id="lightbox-img" src="" alt="Foto ampliada del GTI">
    </div>

    <!-- LAYOUT PRINCIPAL -->
    <div class="hero">
      <!-- PANEL IZQUIERDO -->
      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;">
          <div>
            <div class="price-tag">N√∫meros: 000 ‚Äì 999 ¬∑ Costo desde $1,500 MXN</div>
            <div class="small" style="margin-top:8px">
              Promoci√≥n: 2¬∞ $1,300 ¬∑ 3¬∞ $1,200 ¬∑ 4¬∞+ $1,100
            </div>
          </div>
          <div style="text-align:right;min-width:260px;">
            <div style="font-weight:700;font-size:16px">
              Ganador: 3 √∫ltimos d√≠gitos del Premio Mayor
            </div>
            <div class="small">
              Fecha: pr√≥xima Loter√≠a Nacional despu√©s de completar participantes.
            </div>
          </div>
        </div>

        <hr style="margin:12px 0;border-color:rgba(255,255,255,0.03)">

        <!-- DIN√ÅMICA M√ÅS ATRACTIVA -->
        <h3>üéüÔ∏è ¬øC√≥mo funciona el sorteo?</h3>
        <ul class="small">
          <li><strong>Elige tus n√∫meros favoritos</strong> del <b>000</b> al <b>999</b>.</li>
          <li><strong>Entre m√°s boletos compres</strong>, <b>m√°s barato</b> te sale cada uno.</li>
          <li><strong>Si los √∫ltimos 3 d√≠gitos</strong> del Premio Mayor coinciden con tu n√∫mero, <b>¬°el GTI es tuyo!</b></li>
        </ul>

        <!-- BUSCADOR -->
        <div class="controls">
          <input id="search" class="search" placeholder="Buscar n√∫mero (ej. 042)">
          <button class="btn ghost" id="reset">Mostrar todos</button>
          <button class="btn ghost" id="export">Exportar boletos (.csv)</button>
        </div>

        <!-- CONTADOR -->
        <div class="summary">
          <div class="small">Seleccionados: <span id="selectedCount">0</span></div>
          <div class="small">Total: <strong id="totalPrice">$0 MXN</strong></div>
          <div class="legend">
            <span><span class="legend-dot" style="background:rgba(16,185,129,0.6);"></span>Disponible</span>
            <span><span class="legend-dot" style="background:rgba(245,158,11,0.8);"></span>Apartado</span>
            <span><span class="legend-dot" style="background:rgba(155,17,30,0.8);"></span>Pagado</span>
          </div>
        </div>

        <!-- GRID -->
        <div class="grid card" id="grid" style="margin-top:12px;padding:12px"></div>

        <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;">
          <button class="btn" id="buyBtn">Apartar / Registrar pago</button>
          <button class="btn ghost" id="clearBtn">Borrar selecci√≥n</button>
        </div>

        <div style="margin-top:10px" class="small">
          Toca los n√∫meros disponibles (verde) para seleccionarlos. Se marcar√°n con un
          <strong>resaltado verde brillante</strong> antes de confirmar tu apartado.
        </div>
      </section>

      <!-- PANEL DERECHO -->
      <aside class="card">
        <img src="FRENTE .jpeg"
             style="width:100%;border-radius:10px;margin-bottom:14px;box-shadow:0 4px 14px rgba(0,0,0,0.35);">

        <h3>üèÅ Especificaciones t√©cnicas</h3>
        <ul class="specs small">
          <li>Motor 2.0 TSI Turbo ‚Äî 241 HP</li>
          <li>Torque: 370 Nm ¬∑ DSG 7 velocidades</li>
          <li>Diferencial electr√≥nico VAQ</li>
          <li>0‚Äì100 km/h: 6.4 s</li>
          <li>Vel. M√°xima: 250 km/h</li>
          <li>Suspensi√≥n adaptativa DCC</li>
        </ul>

        <h4 style="margin-top:14px">Tecnolog√≠a e interior</h4>
        <ul class="small">
          <li>Asientos deportivos GTI</li>
          <li>Audio Harman Kardon</li>
          <li>CarPlay / Android Auto</li>
        </ul>

        <hr style="margin:12px 0;border-color:rgba(255,255,255,0.03)">

        <h4>üí≥ Datos bancarios para pagar</h4>
        <div class="bank">
          <div class="bank-label">Cuenta para dep√≥sito / transferencia</div>
          <div class="bank-name">Ricardo Rodr√≠guez Zen√≥n</div>
          <div class="bank-bank">BBVA Bancomer</div>
          <div class="bank-account">4152&nbsp;3139&nbsp;9083&nbsp;5329</div>
          <div class="bank-note">Despu√©s de pagar, env√≠a tu comprobante por WhatsApp al 771&nbsp;127&nbsp;1531.</div>
        </div>
      </aside>
    </div>

    <!-- FOOTER -->
    <footer class="card" style="margin-top:20px;">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
        <div class="small">üî• El GTI 2025 puede ser tuyo</div>
        <div class="small">
          WhatsApp del organizador:
          <a href="https://wa.me/527711271531" style="color:#4ade80;">771 127 1531</a>
        </div>
      </div>
    </footer>
  </div>

  <!-- BARRA FLOTANTE PAGO R√ÅPIDO -->
  <div id="quickPayBar" class="quick-pay">
    <div id="quickPayInfo" class="quick-pay-info">
      Seleccionados: 0 ¬∑ Total: $0 MXN
    </div>
    <button id="quickPayBtn" class="quick-pay-btn">Apartar / Pagar ahora</button>
  </div>

  <!-- MODAL REGISTRO -->
  <div id="modal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:50;">
    <div style="background:#041018;padding:18px;border-radius:12px;max-width:520px;width:92%">
      <h3>Registrar boleto(s)</h3>
      <div class="small" id="modalBody"></div>
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
        <button class="btn ghost" id="modalClose">Cerrar</button>
        <button class="btn" id="modalConfirm">Guardar en sistema</button>
      </div>
    </div>
  </div>

  <!-- üî• FIREBASE + L√ìGICA (igual que ten√≠as) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDocs,
      collection,
      deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
    import {
      getStorage,
      ref,
      uploadBytes,
      getDownloadURL
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDZFqrbthJIfyKjp_WgMpvl92nCs50oQ_o",
      authDomain: "sorteo-gti-2025.firebaseapp.com",
      projectId: "sorteo-gti-2025",
      storageBucket: "sorteo-gti-2025.firebasestorage.app",
      messagingSenderId: "471331929818",
      appId: "1:471331929818:web:3e1fc6a4291fcf96aeefe3",
      measurementId: "G-L72LGS3EJL"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app, "default");
    const storage = getStorage(app);
    const ADMIN_PIN = "1234";

    document.addEventListener("DOMContentLoaded", () => {
      let tickets = {};
      const pad = (n) => String(n).padStart(3, "0");

      const gridEl = document.getElementById("grid");
      const selected = new Set();

      const quickPayBar = document.getElementById("quickPayBar");
      const quickPayInfo = document.getElementById("quickPayInfo");
      const buyBtn = document.getElementById("buyBtn");
      const quickPayBtn = document.getElementById("quickPayBtn");

      if (quickPayBtn && buyBtn) {
        quickPayBtn.onclick = () => buyBtn.click();
      }

      function priceForSelection(count) {
        let total = 0;
        for (let i = 1; i <= count; i++) {
          if (i === 1) total += 1500;
          else if (i === 2) total += 1300;
          else if (i === 3) total += 1200;
          else total += 1100;
        }
        return total;
      }

      function updateSelectionUI() {
        const count = selected.size;
        const total = priceForSelection(count);

        document.getElementById("selectedCount").textContent = count;
        document.getElementById("totalPrice").textContent =
          "$" + total.toLocaleString("es-MX") + " MXN";

        if (quickPayBar) {
          if (count > 0) {
            quickPayBar.style.display = "flex";
            if (quickPayInfo) {
              quickPayInfo.textContent =
                "Seleccionados: " + count +
                " ¬∑ Total: $" + total.toLocaleString("es-MX") + " MXN";
            }
          } else {
            quickPayBar.style.display = "none";
          }
        }
      }

      function renderGrid(filter) {
        gridEl.innerHTML = "";
        const f = (filter || "").trim();

        for (let i = 0; i < 1000; i++) {
          const n = pad(i);
          if (f && !n.includes(f)) continue;

          const data = tickets[n];
          const estado = data?.estado;

          const div = document.createElement("div");
          div.textContent = n;

          if (!estado) {
            div.className = "num available";
            if (selected.has(n)) div.classList.add("selected");
            div.addEventListener("click", () => {
              if (selected.has(n)) {
                selected.delete(n);
                div.classList.remove("selected");
              } else {
                selected.add(n);
                div.classList.add("selected");
              }
              updateSelectionUI();
            });
          } else if (estado === "pagado") {
            div.className = "num sold";
            div.title = `Pagado por ${data.nombre}`;
            div.addEventListener("click", () => liberar(n, data));
          } else {
            div.className = "num reserved";
            div.title = `Apartado por ${data.nombre}`;
            div.addEventListener("click", () => liberar(n, data));
          }

          gridEl.appendChild(div);
        }

        updateSelectionUI();
      }

      async function loadTickets() {
        try {
          const snap = await getDocs(collection(db, "boletos"));
          const tmp = {};
          snap.forEach((d) => (tmp[d.id] = d.data()));
          tickets = tmp;
          renderGrid(document.getElementById("search").value);
        } catch (e) {
          console.error("Error al cargar boletos:", e.code, e.message);
          alert(
            "Error al cargar los boletos (" +
              (e.code || "sin-codigo") +
              "): " +
              (e.message || e)
          );
        }
      }

      async function guardarBoletos({ nombre, telefono, estado, comprobanteFile }) {
        const fecha = new Date().toISOString();
        let comprobanteUrl = "";

        if (comprobanteFile) {
          try {
            const storageRef = ref(
              storage,
              `comprobantes/${Date.now()}_${comprobanteFile.name}`
            );
            const snap = await uploadBytes(storageRef, comprobanteFile);
            comprobanteUrl = await getDownloadURL(snap.ref);
          } catch (e) {
            console.error("Error subiendo comprobante:", e);
            alert(
              "Ojo: no se pudo subir la captura de pago, pero se guardar√° el boleto sin comprobante."
            );
          }
        }

        const ops = [];
        for (const n of selected) {
          const prev = tickets[n] || {};

          const data = {
            ...prev,
            numero: n,
            nombre,
            telefono,
            estado,
            comprobanteUrl: comprobanteUrl || prev.comprobanteUrl || "",
            creadoEn: prev.creadoEn || fecha,
            actualizadoEn: fecha,
          };

          ops.push(setDoc(doc(db, "boletos", n), data));
          tickets[n] = data;
        }

        await Promise.all(ops);
      }

      async function liberar(numero, data) {
        if (!confirm(`¬øLiberar el n√∫mero ${numero}?`)) return;

        const pin = prompt("Clave del organizador:");
        if (pin !== ADMIN_PIN) {
          alert("Clave incorrecta.");
          return;
        }

        try {
          await deleteDoc(doc(db, "boletos", numero));
          delete tickets[numero];
          selected.delete(numero);
          renderGrid(document.getElementById("search").value);
          alert("N√∫mero liberado");
        } catch (e) {
          console.error("Error al liberar n√∫mero:", e);
          alert("Error al liberar n√∫mero: " + (e.message || e));
        }
      }

      // EVENTOS UI
      document.getElementById("reset").onclick = () => {
        document.getElementById("search").value = "";
        renderGrid();
      };

      document.getElementById("clearBtn").onclick = () => {
        selected.clear();
        renderGrid(document.getElementById("search").value);
      };

      document.getElementById("search").oninput = (e) =>
        renderGrid(e.target.value);

      document.getElementById("buyBtn").onclick = () => {
        if (selected.size === 0) {
          alert("Selecciona al menos un n√∫mero.");
          return;
        }

        const numeros = [...selected].sort().join(", ");
        const total = priceForSelection(selected.size).toLocaleString("es-MX");

        const body = document.getElementById("modalBody");
        body.innerHTML = `
          <p>Seleccionaste: <strong>${numeros}</strong></p>
          <p>Total estimado: <strong>$${total} MXN</strong></p>
          <hr>

          <label>Nombre completo<br>
            <input id="buyerName" style="width:100%;padding:6px;border-radius:6px;">
          </label><br>

          <label>Tel√©fono / WhatsApp<br>
            <input id="buyerPhone" style="width:100%;padding:6px;border-radius:6px;">
          </label><br>

          <label>Estado del boleto<br>
            <select id="ticketStatus" style="width:100%;padding:6px;border-radius:6px;">
              <option value="apartado">Apartado</option>
              <option value="pagado">Pagado</option>
            </select>
          </label><br>

          <label>Comprobante de pago (captura)<br>
            <input id="paymentProofFile" type="file" accept="image/*" style="width:100%;padding:6px;border-radius:6px;background:#020617;">
          </label>
        `;

        document.getElementById("modal").style.display = "flex";
      };

      document.getElementById("modalClose").onclick = () => {
        document.getElementById("modal").style.display = "none";
      };

      document.getElementById("modalConfirm").onclick = async () => {
        const nombre = document.getElementById("buyerName").value.trim();
        const telefono = document.getElementById("buyerPhone").value.trim();
        const estado = document.getElementById("ticketStatus").value;
        const fileInput = document.getElementById("paymentProofFile");
        const comprobanteFile =
          fileInput && fileInput.files.length ? fileInput.files[0] : null;

        if (!nombre || !telefono) {
          alert("Llena nombre y tel√©fono.");
          return;
        }

        try {
          await guardarBoletos({ nombre, telefono, estado, comprobanteFile });

          selected.clear();
          renderGrid(document.getElementById("search").value);
          document.getElementById("modal").style.display = "none";
          alert("Boletos registrados.");
        } catch (e) {
          console.error("Error al guardar boletos:", e);
          alert("Error al guardar en sistema: " + (e.message || e));
        }
      };

      document.getElementById("export").onclick = () => {
        const list = Object.values(tickets);
        if (!list.length) {
          alert("No hay boletos.");
          return;
        }

        const csv =
          "numero,nombre,telefono,estado,comprobanteUrl,creadoEn,actualizadoEn\n" +
          list
            .map(
              (t) =>
                `${t.numero},${t.nombre},${t.telefono},${t.estado},${t.comprobanteUrl || ""},${t.creadoEn || ""},${t.actualizadoEn || ""}`
            )
            .join("\n");

        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "boletos_gti2025.csv";
        a.click();
      };

      loadTickets();
    });
  </script>

  <!-- SLIDESHOW ALEATORIO + LIGHTBOX -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const slideshowImg = document.getElementById("slideshow-img");
      const lightbox = document.getElementById("lightbox");
      const lightboxImg = document.getElementById("lightbox-img");

      if (!slideshowImg) return;

      const fotos = [
        "COCHERA .jpeg",
        "FRENTE .jpeg",
        "FRENTE DERECHO .jpeg",
        "FRENTE IZQUIERDO .jpeg",
        "INTERIOR.jpeg",
        "MOTOR .jpeg",
        "PARTE DE ATRAS .jpeg",
        "QUEMACOCOS.jpeg"
      ];

      let actual = 0;

      function cambiarFotoAleatoria() {
        if (fotos.length <= 1) return;

        let siguiente = actual;
        while (siguiente === actual) {
          siguiente = Math.floor(Math.random() * fotos.length);
        }
        actual = siguiente;

        slideshowImg.style.opacity = 0;
        setTimeout(() => {
          slideshowImg.src = fotos[actual];
          slideshowImg.style.opacity = 1;
        }, 300);
      }

      setInterval(cambiarFotoAleatoria, 4000);

      slideshowImg.addEventListener("click", () => {
        lightboxImg.src = slideshowImg.src;
        lightbox.style.display = "flex";
      });

      lightbox.addEventListener("click", () => {
        lightbox.style.display = "none";
      });
    });
  </script>
</body>
</html>